<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:class="${theme != null ? theme : 'dark'}"
      th:lang="${language != null ? language : 'en'}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="#{nav.profile} + ' | FitPlanner'">Profile & Settings | FitPlanner</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <link rel="stylesheet" th:href="@{/css/common.css(v=${#dates.createNow().time})}">
    <link rel="stylesheet" th:href="@{/css/navbar.css(v=${#dates.createNow().time})}">
    <link rel="stylesheet" th:href="@{/css/search-bar.css(v=${#dates.createNow().time})}">
    <link rel="stylesheet" th:href="@{/css/footer.css(v=${#dates.createNow().time})}">
    <link rel="stylesheet" th:href="@{/css/dark-theme.css(v=${#dates.createNow().time})}">
    <link rel="stylesheet" th:href="@{/css/light-theme.css(v=${#dates.createNow().time})}">
    <link rel="stylesheet" th:href="@{/css/scrollbar.css(v=${#dates.createNow().time})}">

    <link rel="stylesheet" th:href="@{/css/profile.css(v=${#dates.createNow().time})}">
</head>
<body>

<div th:replace="~{fragment/navbar.html :: navbar}"></div>

<div class="background-section">
    <div class="container profile-container">
        <form th:action="@{/profile/update}"
              th:object="${profileForm}"
              method="post"
              enctype="multipart/form-data"
              class="profile-form-layout w-100 d-flex flex-column flex-md-row gap-4">

            <input type="hidden" th:field="*{id}">
            <input type="hidden" th:field="*{gender}">
            <input type="hidden" th:field="*{username}">
            <input type="hidden" th:field="*{email}">

            <div class="profile-sidebar">

                <div th:if="${errorMessage}" class="error-message text-danger">
                    <p th:text="${errorMessage}"></p>
                </div>

                <div class="avatar-wrapper" onclick="document.getElementById('imageInput').click()">
                    <img id="profileDisplay"
                         th:src="${profileForm.profileImageUrl != null ? profileForm.profileImageUrl : '/images/default-user-image.webp'}"
                         alt="Avatar">
                    <input type="file"
                           id="imageInput"
                           name="profileImage"
                           accept="image/*"
                           style="display: none;"
                           onchange="previewImage(this)">
                </div>

                <h3 th:text="*{username}">Username</h3>
                <p class="membership-text">
                    <span th:text="#{profile.member_since}">Member since</span>
                    <span th:text="*{createdAt}">2026-01-01</span>
                </p>

                <div class="mt-4">
                    <div class="d-flex justify-content-around">
                        <div class="info-block">
                            <div class="fw-bold highlight-text"
                                 th:text="#{${'Difficulty.' + profileForm.experience}}">BEGINNER</div>
                            <small class="muted-label" th:text="#{profile.level}">Level</small>
                        </div>
                        <div class="info-block">
                            <div class="fw-bold highlight-text"
                                 th:text="#{${'Role.' + profileForm.role}}">USER</div>
                            <small class="muted-label" th:text="#{profile.role}">Role</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="profile-main">
                <div class="section-title" th:text="#{profile.section.personal}">Personal Information</div>
                <div class="row g-3 mb-4">
                    <div class="col-md-6">
                        <label class="form-label font-bold" th:text="#{profile.first_name}">First Name</label>
                        <input type="text" class="fit-input" th:field="*{firstName}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label font-bold" th:text="#{profile.last_name}">Last Name</label>
                        <input type="text" class="fit-input" th:field="*{lastName}">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label font-bold"
                               th:text="#{profile.weight} + ' (' + ${profileForm.measuringUnits} + ')'"></label>
                        <input type="number" step="0.1" class="fit-input" th:field="*{weight}">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label font-bold" th:text="#{profile.age}">Age</label>
                        <input type="number" class="fit-input" th:field="*{age}">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label font-bold" th:text="#{profile.gender}">Gender</label>
                        <input type="text" class="fit-input readonly-input"
                               th:value="#{${'Gender.' + profileForm.gender}}" readonly>
                    </div>
                </div>

                <div class="section-title" th:text="#{profile.section.settings}">App Settings</div>
                <div class="row g-3 mb-4">
                    <div class="col-md-4">
                        <label class="form-label font-bold" th:text="#{profile.theme}">Theme</label>
                        <select class="fit-input" th:field="*{theme}">
                            <option value="dark" th:text="#{profile.theme.dark}">Dark</option>
                            <option value="light" th:text="#{profile.theme.light}">Light</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label font-bold" th:text="#{profile.language}">Language</label>
                        <select class="fit-input" th:field="*{language}">
                            <option value="en">English</option>
                            <option value="bg">Български</option>
                            <option value="es">Español</option>
                            <option value="fr">Français</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label font-bold" th:text="#{profile.units}">Units</label>
                        <select class="fit-input" th:field="*{measuringUnits}">
                            <option value="kg">kg</option>
                            <option value="lbs">lbs</option>
                        </select>
                    </div>
                </div>

                <div class="section-title" th:text="#{profile.section.account}">Account Details</div>
                <div class="row g-3 mb-5">
                    <div class="col-md-12">
                        <label class="form-label font-bold" th:text="#{profile.email}">Email Address</label>
                        <input type="text" class="fit-input readonly-input" th:value="*{email}" readonly>
                    </div>
                </div>

                <div class="d-flex flex-column flex-sm-row align-items-center justify-content-between gap-2 w-100 m-2">
                    <button type="submit" class="btn-save p-2" th:text="#{profile.btn.update}">Update Profile</button>
                    <small class="muted-label">
                        <span th:text="#{profile.last_updated}">Last updated</span>: <span th:text="*{lastUpdated}"></span>
                    </small>
                </div>
            </div>
        </form>
    </div>
</div>
<footer th:replace="~{fragment/footer.html :: footer}"></footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/upload-file.js(v=${#dates.createNow().time})}"></script>
<script th:src="@{/js/weight-units-adjuster.js(v=${#dates.createNow().time})}"></script>
<script th:src="@{/js/notifications.js(v=${#dates.createNow().time})}" defer></script>
</body>
</html>