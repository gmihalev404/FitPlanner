<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:class="${theme != null ? theme : 'dark'}"
      th:lang="${language != null ? language : 'en'}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile & Settings | FitPlanner</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/navbar.css}">
    <link rel="stylesheet" th:href="@{/css/search-bar.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <link rel="stylesheet" th:href="@{/css/dark-theme.css}">
    <link rel="stylesheet" th:href="@{/css/light-theme.css}">

    <link rel="stylesheet" th:href="@{/css/profile.css}">
</head>
<body>

<div th:replace="~{fragment/navbar.html :: navbar}"></div>

<div class="background-section">
    <div class="container profile-container">
        <form th:action="@{/profile/update}"
              th:object="${profileForm}"
              method="post"
              enctype="multipart/form-data"
              class="profile-form-layout w-100 d-flex flex-column flex-md-row gap-4">

            <input type="hidden" th:field="*{id}">
            <input type="hidden" th:field="*{gender}">
            <input type="hidden" th:field="*{username}">
            <input type="hidden" th:field="*{email}">

            <div class="profile-sidebar">
                <div class="avatar-wrapper" onclick="document.getElementById('imageInput').click()">
                    <img id="profileDisplay"
                         th:src="${profileForm.profileImageUrl != null ? profileForm.profileImageUrl : '/images/default-user-image.webp'}"
                         alt="Avatar">
                    <div class="avatar-overlay">
                        <span>Change Photo</span>
                    </div>
                    <input type="file"
                           id="imageInput"
                           name="profileImage"
                           accept="image/*"
                           style="display: none;"
                           onchange="previewImage(this)">
                </div>

                <h3 th:text="*{username}">Username</h3>
                <p class="membership-text">Member since <span th:text="*{createdAt}">2026-01-01</span></p>

                <div class="mt-4">
                    <div class="d-flex justify-content-around">
                        <div class="info-block">
                            <div class="fw-bold highlight-text" th:text="*{experience}">BEGINNER</div>
                            <small class="muted-label">Level</small>
                        </div>
                        <div class="info-block">
                            <div class="fw-bold highlight-text" th:text="*{role}">USER</div>
                            <small class="muted-label">Role</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="profile-main">
                <div class="section-title">Personal Information</div>
                <div class="row g-3 mb-4">
                    <div class="col-md-6">
                        <label class="form-label font-bold">First Name</label>
                        <input type="text" class="fit-input" th:field="*{firstName}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label font-bold">Last Name</label>
                        <input type="text" class="fit-input" th:field="*{lastName}">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label font-bold">Weight (kg)</label>
                        <input type="number" step="0.1" class="fit-input" th:field="*{weight}">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label font-bold">Age</label>
                        <input type="number" class="fit-input" th:field="*{age}">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label font-bold">Gender</label>
                        <input type="text" class="fit-input readonly-input" th:value="*{gender}" readonly>
                    </div>
                </div>

                <div class="section-title">App Settings</div>
                <div class="row g-3 mb-4">
                    <div class="col-md-4">
                        <label class="form-label font-bold">Theme</label>
                        <select class="fit-input" th:field="*{theme}">
                            <option value="dark">Dark</option>
                            <option value="light">Light</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label font-bold">Language</label>
                        <select class="fit-input" th:field="*{language}">
                            <option value="en">English</option>
                            <option value="bg">Български</option>
                            <option value="es">Español</option>
                            <option value="fr">Français</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label font-bold">Units</label>
                        <select class="fit-input" th:field="*{measuringUnits}">
                            <option value="kg">kg</option>
                            <option value="lbs">lbs</option>
                        </select>
                    </div>
                </div>

                <div class="section-title">Account Details</div>
                <div class="row g-3 mb-5">
                    <div class="col-md-12">
                        <label class="form-label font-bold">Email Address</label>
                        <input type="text" class="fit-input readonly-input" th:value="*{email}" readonly>
                    </div>
                </div>

                <div class="d-flex flex-column flex-sm-row align-items-center justify-content-between gap-2 w-100 m-2">
                    <button type="submit" class="btn-save p-2">Update Profile</button>
                    <small class="muted-label">Last updated: <span th:text="*{lastUpdated}"></span></small>
                </div>
            </div>
        </form>
    </div>
</div>
<footer th:replace="~{fragment/footer.html :: footer}"></footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/import-profile-image.js}"></script>
</body>
</html>