<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:class="${userDto != null ? userDto.theme : 'dark'}"
      th:lang="${userDto != null ? userDto.language : 'en'}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitPlanner | Admin Panel</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <link rel="stylesheet" th:href="@{/css/common.css(v=${#dates.createNow().time})}">
    <link rel="stylesheet" th:href="@{/css/navbar.css(v=${#dates.createNow().time})}">
    <link rel="stylesheet" th:href="@{/css/footer.css(v=${#dates.createNow().time})}">
    <link rel="stylesheet" th:href="@{/css/dark-theme.css(v=${#dates.createNow().time})}">
    <link rel="stylesheet" th:href="@{/css/light-theme.css(v=${#dates.createNow().time})}">

    <style>
        .background-section {
            background-color: var(--bg-app);
            min-height: 100vh;
            padding-top: 100px;
            padding-bottom: 50px;
        }

        .admin-main-container { min-height: 80vh; }

        .glass-panel {
            background: var(--bg-container);
            border: 1px solid var(--border-card);
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: var(--shadow-card);
        }

        /* Fixed Table Styling */
        .table {
            --bs-table-bg: transparent !important;
            color: var(--text-main) !important;
            border-color: var(--border-soft);
        }
        .table td, .table th {
            background-color: transparent !important;
            color: var(--text-main) !important;
            border-bottom-color: var(--border-soft);
        }
        .table tr:hover { background-color: var(--hover-light) !important; }

        .nav-pills .nav-link {
            color: var(--text-muted);
            border: 1px solid var(--border-soft);
            margin: 5px;
            background: var(--btn-bg);
        }
        .nav-pills .nav-link.active {
            background-color: var(--delimiter-color) !important;
            color: #ffffff !important;
        }

        .modal-content {
            background: var(--bg-container);
            border: 1px solid var(--border-card);
            color: var(--text-main);
        }
        .form-control, .form-select {
            background: var(--bg-input) !important;
            border: 1px solid var(--border-input);
            color: var(--text-input) !important;
        }

        .btn-main { background: var(--delimiter-color); color: white; border: none; transition: 0.3s; }
        .btn-main:hover { opacity: 0.8; color: white; }

        .btn-action {
            width: 32px; height: 32px; border-radius: 50%;
            display: inline-flex; align-items: center; justify-content: center;
            background: var(--bg-body); border: 1px solid var(--border-soft);
            transition: 0.3s;
        }
        .btn-edit { color: var(--text-link); }
        .btn-delete { color: #ff4d4d; }
    </style>
</head>
<body>
<div th:replace="~{fragment/navbar.html::navbar}"></div>

<div class="background-section">
    <div class="container admin-main-container">

        <div class="text-center mb-5">
            <h2 class="display-5 fw-bold text-uppercase" style="color: var(--text-main)">
                Management <span style="color: var(--delimiter-color)">Hub</span>
            </h2>
            <ul class="nav nav-pills justify-content-center" id="adminTab" role="tablist">
                <li class="nav-item">
                    <button class="nav-link active rounded-pill px-4" data-bs-toggle="pill" data-bs-target="#ex-panel">Exercises</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link rounded-pill px-4" data-bs-toggle="pill" data-bs-target="#q-panel">Quotes</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link rounded-pill px-4" data-bs-toggle="pill" data-bs-target="#user-panel">Users</button>
                </li>
            </ul>
        </div>

        <div class="tab-content">
            <div class="tab-pane fade show active" id="ex-panel">
                <div class="glass-panel">
                    <div class="d-flex flex-column flex-sm-row justify-content-between align-items-center mb-4 gap-3">
                        <h4 class="m-0 fw-bold">Exercises</h4>
                        <button class="btn btn-main rounded-pill px-4" data-bs-toggle="modal" data-bs-target="#addExModal">
                            <i class="bi bi-plus-lg me-1"></i> ADD EXERCISE
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                            <tr>
                                <th>Name</th>
                                <th>Category</th>
                                <th class="d-none d-md-table-cell">Type</th>
                                <th class="text-end">Actions</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="ex : ${exercises}">
                                <td class="fw-bold" th:text="${ex.name}">Name</td>
                                <td th:text="${ex.category}">Category</td>
                                <td class="d-none d-md-table-cell" th:text="${ex.exerciseType}">Type</td>
                                <td class="text-end text-nowrap">
                                    <button class="btn-action btn-edit me-1" data-bs-toggle="modal" th:data-bs-target="'#editEx' + ${ex.id}"><i class="bi bi-pencil"></i></button>
                                    <form th:action="@{/admin/exercises/delete/{id}(id=${ex.id})}" method="POST" class="d-inline">
                                        <button class="btn-action btn-delete"><i class="bi bi-trash"></i></button>
                                    </form>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="q-panel">
                <div class="glass-panel">
                    <div class="d-flex flex-column flex-sm-row justify-content-between align-items-center mb-4 gap-3">
                        <h4 class="m-0 fw-bold">Inspirational Quotes</h4>
                        <button class="btn btn-main rounded-pill px-4" data-bs-toggle="modal" data-bs-target="#addQModal">
                            <i class="bi bi-plus-lg me-1"></i> ADD QUOTE
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                            <tr>
                                <th>Text</th>
                                <th>Author</th>
                                <th class="text-end">Actions</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="q : ${quotes}">
                                <td th:text="${q.text}" class="small">Text</td>
                                <td th:text="${q.author}" style="color: var(--text-soft)">Author</td>
                                <td class="text-end">
                                    <button class="btn-action btn-edit me-1" data-bs-toggle="modal" th:data-bs-target="'#editQ' + ${q.id}"><i class="bi bi-pencil"></i></button>
                                    <form th:action="@{/admin/quotes/delete/{id}(id=${q.id})}" method="POST" class="d-inline">
                                        <button class="btn-action btn-delete"><i class="bi bi-trash"></i></button>
                                    </form>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="tab-pane fade" id="user-panel">
    <div class="glass-panel">
        <h4 class="mb-4 fw-bold">User Oversight</h4>
        <div class="table-responsive">
            <table class="table">
                <thead>
                <tr>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th class="text-end">Actions</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="user : ${allUsers}">
                    <td>
                        <span class="fw-bold" th:text="${user.username}">Username</span>
                        <span th:if="${user.id == userDto.id}" class="badge bg-secondary ms-1" style="font-size: 0.6rem">YOU</span>
                    </td>
                    <td th:text="${user.email}" class="small text-muted">email@example.com</td>
                    <td>
                        <span class="badge badge-type" th:text="${user.role}">ROLE</span>
                    </td>
                    <td class="text-end">
                        <form th:action="@{/admin/users/toggle-role/{id}(id=${user.id})}" method="POST" class="d-inline">
                            <button class="btn-action btn-edit me-1" title="Change Role"
                                    th:disabled="${user.id == userDto.id}">
                                <i class="bi bi-shield-lock"></i>
                            </button>
                        </form>
                        <form th:action="@{/admin/users/delete/{id}(id=${user.id})}" method="POST" class="d-inline">
                            <button class="btn-action btn-delete" th:disabled="${user.id == userDto.id}">
                                <i class="bi bi-person-x"></i>
                            </button>
                        </form>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="modal fade" id="addExModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-3">
            <form th:action="@{/admin/exercises/add}" method="POST">
                <h5 class="fw-bold mb-4">New Exercise</h5>
                <div class="mb-3">
                    <label class="small fw-bold mb-1">Name</label>
                    <input type="text" name="name" class="form-control" placeholder="Exercise Name" required>
                </div>
                <div class="row g-2 mb-3">
                    <div class="col-6">
                        <label class="small fw-bold mb-1">Category</label>
                        <select name="category" class="form-select">
                            <option th:each="c : ${categories}" th:value="${c}" th:text="${c}"></option>
                        </select>
                    </div>
                    <div class="col-6">
                        <label class="small fw-bold mb-1">Type</label>
                        <select name="exerciseType" class="form-select">
                            <option th:each="t : ${exerciseTypes}" th:value="${t}" th:text="${t}"></option>
                        </select>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="small fw-bold mb-1">Equipment</label>
                    <select name="equipmentType" class="form-select">
                        <option th:each="e : ${equipmentTypes}" th:value="${e}" th:text="${e}"></option>
                    </select>
                </div>
                <button type="submit" class="btn btn-main w-100 rounded-pill fw-bold">SAVE EXERCISE</button>
            </form>
        </div>
    </div>
</div>

<div th:each="ex : ${exercises}" class="modal fade" th:id="'editEx' + ${ex.id}" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-3">
            <form th:action="@{/admin/exercises/edit/{id}(id=${ex.id})}" method="POST">
                <h5 class="fw-bold mb-4">Edit Exercise</h5>
                <div class="mb-3">
                    <label class="small fw-bold mb-1">Name</label>
                    <input type="text" name="name" class="form-control" th:value="${ex.name}" required>
                </div>
                <div class="row g-2 mb-3">
                    <div class="col-6">
                        <label class="small fw-bold mb-1">Category</label>
                        <select name="category" class="form-select">
                            <option th:each="c : ${categories}" th:value="${c}" th:text="${c}" th:selected="${c == ex.category}"></option>
                        </select>
                    </div>
                    <div class="col-6">
                        <label class="small fw-bold mb-1">Type</label>
                        <select name="exerciseType" class="form-select">
                            <option th:each="t : ${exerciseTypes}" th:value="${t}" th:text="${t}" th:selected="${t == ex.exerciseType}"></option>
                        </select>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="small fw-bold mb-1">Equipment</label>
                    <select name="equipmentType" class="form-select">
                        <option th:each="e : ${equipmentTypes}" th:value="${e}" th:text="${e}" th:selected="${e == ex.equipmentType}"></option>
                    </select>
                </div>
                <button type="submit" class="btn btn-main w-100 rounded-pill fw-bold">UPDATE EXERCISE</button>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="addQModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-3">
            <form th:action="@{/admin/quotes/add}" method="POST">
                <h5 class="fw-bold mb-4">New Quote</h5>
                <textarea name="text" class="form-control mb-3" rows="3" placeholder="Enter quote..." required></textarea>
                <input type="text" name="author" class="form-control mb-4" placeholder="Author">
                <button type="submit" class="btn btn-main w-100 rounded-pill fw-bold">SAVE QUOTE</button>
            </form>
        </div>
    </div>
</div>

<div th:each="q : ${quotes}" class="modal fade" th:id="'editQ' + ${q.id}" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-3">
            <form th:action="@{/admin/quotes/edit/{id}(id=${q.id})}" method="POST">
                <h5 class="fw-bold mb-4">Edit Quote</h5>
                <textarea name="text" class="form-control mb-3" rows="3" th:text="${q.text}" required></textarea>
                <input type="text" name="author" class="form-control mb-4" th:value="${q.author}">
                <button type="submit" class="btn btn-main w-100 rounded-pill fw-bold">UPDATE</button>
            </form>
        </div>
    </div>
</div>

<footer th:replace="~{fragment/footer.html::footer}"></footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>