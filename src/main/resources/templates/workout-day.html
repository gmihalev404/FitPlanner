<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:class="${theme != null ? theme : 'dark'}"
      th:lang="${language != null ? language : 'en'}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="#{workout.day.title} + ' | FitPlanner'">Workout Day</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <link rel="stylesheet" th:href="@{/css/common.css(v=${#dates.createNow().time})}">
    <link rel="stylesheet" th:href="@{/css/navbar.css(v=${#dates.createNow().time})}">
    <link rel="stylesheet" th:href="@{/css/footer.css(v=${#dates.createNow().time})}">
    <link rel="stylesheet" th:href="@{/css/dark-theme.css(v=${#dates.createNow().time})}">
    <link rel="stylesheet" th:href="@{/css/light-theme.css(v=${#dates.createNow().time})}">
    <link rel="stylesheet" th:href="@{/css/search-bar.css(v=${#dates.createNow().time})}">
    <link rel="stylesheet" th:href="@{/css/scrollbar.css(v=${#dates.createNow().time})}">
    <link rel="stylesheet" th:href="@{/css/workout-day.css(v=${#dates.createNow().time})}">
</head>
<body>
<div th:replace="fragment/navbar.html::navbar"></div>
<div class="background-section">
    <div class="container session-container p-3 pt-5 d-flex flex-column justify-content-center">

        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h4 class="fw-bold mb-0" th:text="#{workout.for} + ' ' + ${date}"></h4>
                <div class="mt-2">
                    <span th:if="${isFinished}" class="badge bg-success status-badge">
                        <i class="bi bi-check-circle-fill"></i> <span th:text="#{workout.status.completed}">Completed</span>
                    </span>
                    <span th:if="${!isFinished && isPast && !isToday}" class="badge bg-secondary status-badge">
                        <i class="bi bi-clock-history"></i> <span th:text="#{workout.status.past}">Past Session</span>
                    </span>
                    <span th:if="${!isFinished && isToday}" class="badge bg-warning text-dark status-badge">
                        <i class="bi bi-lightning-charge-fill"></i> <span th:text="#{workout.status.today}">Today's Goal</span>
                    </span>
                </div>
            </div>
        </div>

        <div th:if="${exercises.isEmpty()}" class="text-center w-100 py-5">
            <i class="bi bi-calendar-x fs-1 text-muted"></i>
            <p class="fw-bold mt-2" th:text="#{workout.no_exercises} + ' ' + ${date}"></p>
        </div>

        <div th:if="${!exercises.isEmpty()}" class="session-exercises scrollable-container">
            <div th:each="exercise : ${exercises}" class="row align-items-center mb-3 border-bottom pb-2 g-0 exercise-row">

                <div class="col-5 col-lg-3 d-flex flex-column">
                    <label th:text="${exercise.name}" class="fw-bold text-truncate d-block mb-0"></label>
                    <span th:text="#{exercise.program} + ': ' + ${exercise.programName}" class="text-info text-truncate small"></span>
                </div>

                <div class="col-2 col-lg-5 d-flex flex-column flex-lg-row justify-content-lg-around small px-1">
                    <span class="fw-bold">
                        <i class="bi bi-weight me-1"></i>
                        <span th:text="${#numbers.formatDecimal(exercise.weight, 1, 2)} + ' ' + ${units}"></span>
                    </span>
                    <span>
                        <i class="bi bi-arrow-repeat me-1"></i>
                        <span th:text="${exercise.reps} + ' ' + #{exercise.reps}"></span>
                    </span>
                    <span>
                        <i class="bi bi-layers me-1"></i>
                        <span th:text="${exercise.sets} + ' ' + #{exercise.sets}"></span>
                    </span>
                </div>

                <div class="col-2 col-lg-2 text-center text-lg-start">
                    <span th:if="${exercise.finished}" class="text-success fw-bold small">
                        <i class="bi bi-check-lg"></i> <span th:text="#{exercise.done}">Done</span>
                    </span>
                    <span th:if="${!exercise.finished && (isFinished || isPast)}" class="text-muted small italic" th:text="#{exercise.skipped}">
                        Skipped
                    </span>
                </div>

                <div class="col-3 col-lg-2 d-flex justify-content-end align-items-center">
                    <span th:if="${isFinished || isPast}" class="read-only-icon text-muted" th:title="#{workout.readonly}">
                        <i class="bi bi-lock-fill fs-5"></i>
                    </span>
                </div>
            </div>
        </div>

        <div th:if="${!exercises.isEmpty() && (isToday || isPast)}" class="row justify-content-center mt-auto pt-4">
            <form th:action="@{/workout-session}" method="get" class="col-auto">
                <input type="hidden" name="year" th:value="${date.year}">
                <input type="hidden" name="month" th:value="${date.monthValue}">
                <input type="hidden" name="day" th:value="${date.dayOfMonth}">
                <div th:each="programId : ${selectedProgramIds}">
                    <input type="hidden" name="programIds" th:value="${programId}">
                </div>

                <button th:if="${isToday && !isFinished}" class="btn btn-success px-5 py-2 fw-bold shadow-sm" type="submit">
                    <i class="bi bi-play-circle-fill me-2"></i> <span th:text="#{workout.btn.start}">Start Session</span>
                </button>

                <button th:if="${isFinished || (isPast && !isToday)}" class="btn btn-outline-info px-5 py-2 fw-bold shadow-sm" type="submit">
                    <i class="bi bi-info-circle-fill me-2"></i> <span th:text="#{workout.btn.summary}">View Day Summary</span>
                </button>
            </form>
        </div>

        <form th:action="@{/close-day-session}" method="post" class="close-form">
            <button type="submit" class="close-btn" th:title="#{exercise.close}">âœ•</button>
        </form>
    </div>
</div>

<footer th:replace="fragment/footer.html::footer"></footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/notifications.js(v=${#dates.createNow().time})}" defer></script>
</body>
</html>