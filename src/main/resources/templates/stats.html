<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:class="${theme != null ? theme : 'dark'}"
      th:lang="${language != null ? language : 'en'}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistics</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" th:href="@{/css/common.css?t=1}">
    <link rel="stylesheet" th:href="@{/css/search-bar.css?t=1}">
    <link rel="stylesheet" th:href="@{/css/scrollbar.css?t=1}">
    <link rel="stylesheet" th:href="@{/css/navbar.css?t=1}">
    <link rel="stylesheet" th:href="@{/css/footer.css?t=1}">
    <link rel="stylesheet" th:href="@{/css/dark-theme.css?t=1}">
    <link rel="stylesheet" th:href="@{/css/light-theme.css?t=1}">

    <link rel="stylesheet" th:href="@{/css/stats.css?t=1}">
</head>
<body>
<div th:replace="fragment/navbar.html::navbar"></div>
<div class="background-section">
    <div class="container my-5 p-2">
        <h1 class="mb-4">Statistics</h1>
        <div th:replace="fragment/search-bar.html::search-bar('exerciseSearch', #{exercise.search_placeholder})"></div>
        <div class="row mb-4 mt-3">
            <div class="col-md-4 mb-2">
                <select id="categoryFilter" class="form-select">
                    <option value="" th:text="#{exercise.all_categories}">All Categories</option>
                    <option value="legs" th:text="#{cat.legs}">Legs</option>
                    <option value="core" th:text="#{cat.core}">Core</option>
                    <option value="back" th:text="#{cat.back}">Back</option>
                    <option value="biceps" th:text="#{cat.biceps}">Biceps</option>
                    <option value="triceps" th:text="#{cat.triceps}">Triceps</option>
                    <option value="chest" th:text="#{cat.chest}">Chest</option>
                </select>
            </div>
            <div class="col-md-4 mb-2">
                <select id="difficultyFilter" class="form-select">
                    <option value="" th:text="#{exercise.all_difficulties}">All Difficulties</option>
                    <option value="novice" th:text="#{diff.novice}">Novice</option>
                    <option value="beginner" th:text="#{diff.beginner}">Beginner</option>
                    <option value="medium" th:text="#{diff.medium}">Medium</option>
                    <option value="advanced" th:text="#{diff.advanced}">Advanced</option>
                    <option value="master" th:text="#{diff.master}">Master</option>
                </select>
            </div>
            <div class="col-md-4 mb-2">
                <select id="equipmentFilter" class="form-select">
                    <option value="" th:text="#{exercise.all_equipment}">All Equipment</option>
                    <option value="body_weight" th:text="#{eq.body_weight}">Body weight</option>
                    <option value="weighted" th:text="#{eq.weighted}">Weighted</option>
                    <option value="machine" th:text="#{eq.machine}">Machine</option>
                    <option value="cardio" th:text="#{eq.cardio}">Cardio</option>
                </select>
            </div>
        </div>

        <div class="exercise-grid-container scrollable-container mb-5">
            <div class="row g-3 justify-content-start" id="exerciseRow">
                <div th:each="ex : ${exercises}"
                     class="col-4 col-md-3 col-lg-2 exercise-item"
                     th:attr="
                    data-id=${ex.id},
                    data-name=${ex.name},
                    data-category=${#strings.toLowerCase(ex.category)},
                    data-difficulty=${#strings.toLowerCase(ex.difficulty)},
                    data-equipment=${#strings.toLowerCase(ex.equipmentType)}
                 ">
                    <div class="card exercise-selectable-card p-0 h-100" onclick="toggleExercise(this)">
                        <div class="card-body p-0 d-flex flex-column justify-content-center align-items-center text-center">
                            <div class="exercise-name-label" th:text="${ex.name}">Exercise Name</div>
                        </div>
                    </div>
                </div>
                <div id="noResults" class="col-12 text-center p-3" style="display: none;" th:text="#{exercise.no_results}">
                    No results
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12 mb-5">
                <div class="card shadow-sm">
                    <div class="card-header text-white d-flex justify-content-between align-items-center">
                        <span>Exercise Progress Comparison</span>
                        <small id="selectedCounter" class="badge bg-light text-primary">0 selected</small>
                    </div>
                    <div class="card-body chart-container">
                        <canvas id="exerciseProgressChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="col-12 mb-5">
                <div class="card shadow-sm">
                    <div class="card-header text-white">Personal Progress (Weight)</div>
                    <div class="card-body chart-container">
                        <canvas id="personalProgressChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<footer th:replace="fragment/footer.html::footer"></footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:src="@{/js/filters.js?t=1}"></script>
<script th:src="@{/js/search-bar.js?t=1}"></script>
<script th:inline="javascript">
    /* These variables are initialized by Thymeleaf and made global for stats.js */
    window.userStatsConfig = {
        unit: /*[[${units != null ? units : 'kg'}]]*/ 'kg',
        personalLabels: /*[[${personalLabels}]]*/ [],
        personalData: /*[[${personalData}]]*/ []
    };
</script>
<script th:src="@{/js/stats.js?t=1}"></script>
</body>
</html>